{% extends "wiki/base.html" %}
{% load core_extras %}
{% block title %}
  {% if search_query %}Search: {{ search_query }} ·{% endif %}
  Docs · {{ block.super }}
{% endblock %}
{% block breadcrumbs %}{{ block.super }}<span>Search</span>{% endblock %}
{% block main %}
  <div class="filter-bar">
    <div class="filter-bar__search filter-bar__search--full">
      <form method="get" action="{% url 'wiki-search' %}">
        <input type="search"
               name="q"
               placeholder="Search docs..."
               value="{{ search_query }}"
               class="filter-bar__search-input">
        {% icon "magnifying-glass" class="filter-bar__search-icon" %}
      </form>
    </div>
  </div>
  {% if search_query %}
    {% if pages %}
      <p class="text-muted">Found {{ page_obj.paginator.count }} result{{ page_obj.paginator.count|pluralize }}</p>
      {% for page in pages %}
        <div class="card card--padded space-above-sm">
          <div>
            {% with first_tag=page.tags.all.0 %}
              <a href="{% url 'wiki-page-detail' first_tag %}">{{ page.title }}</a>
            {% endwith %}
          </div>
          <div class="text-sm text-muted">
            Updated {{ page.updated_at|smart_date }}
            {% if page.tags.all %}
              · {% icon "folder" class="meta" %}
              {% for tag in page.tags.all %}
                {{ tag.tag|default:"(root)" }}
                {% if not forloop.last %},{% endif %}
              {% endfor %}
            {% endif %}
          </div>
        </div>
      {% endfor %}
      {% if page_obj.has_other_pages %}
        <nav aria-label="Pagination">
          {% if page_obj.has_previous %}
            <a href="?q={{ search_query|urlencode }}&page={{ page_obj.previous_page_number }}"
               class="btn btn--secondary">Previous</a>
          {% endif %}
          <span class="text-muted">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
          {% if page_obj.has_next %}
            <a href="?q={{ search_query|urlencode }}&page={{ page_obj.next_page_number }}"
               class="btn btn--secondary">Next</a>
          {% endif %}
        </nav>
      {% endif %}
    {% else %}
    {% empty_state empty_message="No pages found." search_message="Try different keywords." is_search=True %}
    {% endif %}
  {% endif %}
{% endblock %}
