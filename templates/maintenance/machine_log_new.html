{% extends "base.html" %}
{% block title %}New Log Entry · {{ block.super }}{% endblock %}
{% block content %}
  <nav class="breadcrumb">
    <a href="{% url 'maintainer-machine-list' %}">Machines</a>
    <span>›</span>
    <a href="{% url 'maintainer-machine-detail' machine.slug %}">{{ machine.display_name }}</a>
    <span>›</span>
    <a href="{% url 'log-machine' machine.slug %}">Logs</a>
    <span>›</span>
    <strong>New Log Entry</strong>
  </nav>
  <section class="card">
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="tz_offset" id="tz-offset">
      <div class="form-field">
        <label for="{{ form.work_date.id_for_label }}">Date of work</label>
        {{ form.work_date }}
        {% for error in form.work_date.errors %}<div class="error">{{ error }}</div>{% endfor %}
      </div>
      <div class="form-field">
        <label for="{{ form.submitter_name.id_for_label }}">Your name</label>
        {{ form.submitter_name }}
        {% for error in form.submitter_name.errors %}<div class="error">{{ error }}</div>{% endfor %}
      </div>
      <div class="form-field">
        <label for="{{ form.text.id_for_label }}">Description</label>
        {{ form.text }}
        {% for error in form.text.errors %}<div class="error">{{ error }}</div>{% endfor %}
      </div>
      <div class="form-field">
        <label for="{{ form.media_file.id_for_label }}">Photo (optional)</label>
        {{ form.media_file }}
        {% for error in form.media_file.errors %}<div class="error">{{ error }}</div>{% endfor %}
      </div>
      <button type="submit" class="btn btn-primary">Create Log Entry</button>
    </form>
  </section>
{% endblock %}
{% block extra_scripts %}
  <script>
      // Helper: format Date as datetime-local value (YYYY-MM-DDTHH:MM)
      function toDateTimeLocalValue(date) {
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          const hours = String(date.getHours()).padStart(2, '0');
          const minutes = String(date.getMinutes()).padStart(2, '0');
          return `${year}-${month}-${day}T${hours}:${minutes}`;
      }

      // Set timezone offset for form submission
      document.getElementById('tz-offset').value = new Date().getTimezoneOffset();

      // Set default work_date to current time in browser's local timezone
      const workDateInput = document.getElementById('{{ form.work_date.id_for_label }}');
      if (workDateInput) {
          workDateInput.value = toDateTimeLocalValue(new Date());
      }
  </script>
{% endblock %}
