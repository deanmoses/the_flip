{% extends "layouts/two_column.html" %}
{% load static core_extras %}
{% block title %}
  {% if entry.machine %}{{ entry.machine.short_display_name }} ·{% endif %}
  Log #{{ entry.pk }} · {{ block.super }}
{% endblock %}
{% block breadcrumbs %}
  <a href="{% url 'maintainer-machine-list' %}">Machines</a>
  <a href="{% url 'maintainer-machine-detail' entry.machine.slug %}">{{ entry.machine.short_display_name }}</a>
  {% if entry.problem_report %}
    <a href="{% url 'problem-report-detail' entry.problem_report.pk %}">{% icon "bug" label="Problem" %} #{{ entry.problem_report.pk }}</a>
  {% else %}
    <a href="{% url 'maintainer-machine-detail' entry.machine.slug %}?f=logs">Logs</a>
  {% endif %}
  <span>Log Entry {% icon "screwdriver-wrench" %}</span>
{% endblock %}
{% block mobile_actions %}
  <div class="mobile-meta">
    <div class="mobile-meta__row text-muted text-sm">{{ entry|log_entry_meta }}</div>
  </div>
  <a href="{% url 'log-entry-edit' entry.pk %}"
     class="btn btn--secondary btn--full">{% icon "pen" class="meta" label="Edit Details" %}</a>
{% endblock %}
{% block sidebar %}
  {% include "components/history_link.html" with history_url=entry.get_admin_history_url %}
  {% sidebar_section label="Log Entry" %}
  <div class="sidebar__subtitle space-above-sm">{{ entry|log_entry_meta }}</div>
{% endsidebar_section %}
{% sidebar_section label="Machine" %}
{% if entry.problem_report %}
  {# Machine is controlled by problem report, not directly editable #}
  {% include "components/machine_sidebar_card.html" with machine=entry.machine %}
{% else %}
  {# Orphan log entry: machine is directly editable #}
  {% include "components/machine_sidebar_card.html" with machine=entry.machine editable=True %}
{% endif %}
{% endsidebar_section %}
{% sidebar_section label="Problem" %}
{% include "components/problem_report_sidebar_card.html" with problem_report=entry.problem_report editable=True current_machine_slug=entry.machine.slug %}
{% endsidebar_section %}
{% sidebar_section %}
<a href="{% url 'log-entry-edit' entry.pk %}"
   class="btn btn--secondary btn--full">
  {% icon "pen" class="meta" %}
  Edit Details
</a>
{% endsidebar_section %}
{% endblock %}
{% block main %}
  <!-- DESCRIPTION CARD -->
  {% include "core/partials/text_card_editable.html" with content=entry.text %}
  <!-- MEDIA CARD -->
  {% include "core/partials/media_card_editable.html" with media_items=entry.media.all alt="Log entry photo" model_name="LogEntryMedia" %}
{% endblock %}
{% block extra_scripts %}
  {% include "core/partials/markdown_textarea_scripts.html" %}
  {% include "core/partials/markdown_inline_edit_scripts.html" %}
  <script src="{% static 'core/media_grid.js' %}" defer></script>
  <script src="{% static 'core/video_transcode_poll.js' %}" defer></script>
  <script src="{% static 'core/searchable_dropdown.js' %}" defer></script>
  <script src="{% static 'core/sidebar_card_edit.js' %}" defer></script>
{% endblock %}
