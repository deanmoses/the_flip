{% load core_extras %}
{% timeline_entry icon="bug" variant="problem" %}
<div class="card card--problem timeline__card">
  <a href="{% url 'problem-report-detail' entry.pk %}"
     class="timeline__card-link">
    <div class="timeline__header">
      <div class="flex items-center stack-tight">
        <span class="timeline__title timeline__title--problem">Problem</span>
        <span class="badge {% if entry.status == 'open' %}badge--warning{% else %}badge--success{% endif %}">
          {{ entry.get_status_display }}
        </span>
      </div>
      <span class="timeline__meta">{{ entry|problem_report_meta }}</span>
    </div>
  </a>
  <div class="timeline__body {% if entry.media.all or entry.prefetched_log_entries %}space-below-sm{% endif %} markdown-content markdown-content--compact">
    {% if entry.description %}
      {{ entry.description|render_markdown }}
    {% else %}
      {{ entry|problem_report_summary }}
    {% endif %}
  </div>
  {% url 'problem-report-detail' entry.pk as entry_url %}
  {% include "core/partials/media_grid_readonly.html" with media_items=entry.media.all detail_url=entry_url %}
  {% if entry.prefetched_log_entries %}
    {% with latest_log=entry.prefetched_log_entries.0 %}
      <a href="{% url 'log-detail' latest_log.pk %}"
         class="timeline__snippet-link">
        <span class="snippet-label text-log">
          <i class="fa-solid fa-screwdriver-wrench"></i>Latest:
        </span>
        <span class="snippet-text">{{ latest_log.text|truncatewords:15 }}</span>
      </a>
    {% endwith %}
  {% endif %}
</div>
{% endtimeline_entry %}
