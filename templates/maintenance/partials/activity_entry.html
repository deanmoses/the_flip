{% load core_extras %}
{% if entry.entry_type == "log" %}
  <li class="machine-card js-clickable-card"
      data-url="{% url 'log-detail' entry.pk %}"
      tabindex="0"
      role="button"
      aria-label="View log entry">
    <div class="machine-card__row">
      <div class="machine-card__row-left"></div>
      <div class="log-entry-meta machine-card__top-right">
        <strong>{{ entry.created_at|smart_date }}</strong>
        {% if entry.maintainers.all %}
          by {{ entry.maintainers.all|join:", " }}
        {% elif entry.maintainer_names %}
          by {{ entry.maintainer_names }}
        {% endif %}
      </div>
    </div>
    <div class="machine-card__problem markdown-content markdown-content--compact">{{ entry.text|render_markdown }}</div>
    {% if entry.problem_report %}
      <div class="machine-card__row">
        <div class="machine-card__row-left"></div>
        <div class="machine-card__location machine-card__problem-report-snippet">
          <strong>Problem report:</strong> {{ entry.problem_report.description|default:entry.problem_report.get_problem_type_display }}
        </div>
      </div>
    {% endif %}
    {% if entry.media.all %}
      <div class="machine-card__row">
        <div class="machine-card__row-left">
          {% for media in entry.media.all %}
            {% if media.media_type == 'video' %}
              {% if media.transcode_status == 'ready' and media.poster_file %}
                <img src="{{ media.poster_file.url }}"
                     alt="Video poster"
                     width="200"
                     class="media-thumbnail">
              {% elif media.transcode_status == 'processing' or media.transcode_status == 'pending' %}
                <span class="media-status">Video processingâ€¦</span>
              {% else %}
                <span class="media-status error">Video failed</span>
              {% endif %}
            {% else %}
              <img src="{{ media.file.url }}"
                   alt="Photo"
                   width="200"
                   class="media-thumbnail">
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </li>
{% elif entry.entry_type == "problem_report" %}
  <li class="machine-card js-clickable-card"
      data-url="{% url 'problem-report-detail' entry.pk %}"
      tabindex="0"
      role="button"
      aria-label="View problem report">
    <div class="machine-card__row">
      <div class="machine-card__row-left">
        <span class="badge badge-status badge-{{ entry.status }}">{{ entry.get_status_display }}</span>
        <span class="text-muted">Problem Report</span>
      </div>
      <div class="log-entry-meta machine-card__top-right">
        <strong>{{ entry.created_at|smart_date }}</strong>
      </div>
    </div>
    <div class="machine-card__problem">
      {% if entry.problem_type != entry.PROBLEM_OTHER %}
        <span class="machine-card__problem-label">{{ entry.get_problem_type_display }}:</span>
      {% endif %}
      {{ entry.description|default:"Problem reported (no description)" }}
    </div>
    {% if entry.prefetched_log_entries %}
      {% with latest_log=entry.prefetched_log_entries.0 %}
        <div class="machine-card__row">
          <div class="machine-card__row-left"></div>
          <div class="machine-card__location machine-card__problem-report-snippet">
            <strong>Latest log:</strong> {{ latest_log.text }}
          </div>
        </div>
      {% endwith %}
    {% endif %}
  </li>
{% endif %}
