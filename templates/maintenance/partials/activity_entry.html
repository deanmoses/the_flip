{% load core_extras %}
{% if entry.entry_type == "log" %}
  <div class="timeline__entry">
    <a href="{% url 'log-detail' entry.pk %}" class="timeline__entry-inner">
      <div class="timeline__icon timeline__icon--log">
        <i class="fa-solid fa-screwdriver-wrench"></i>
      </div>
      <div class="timeline__content">
        <div class="card card--log timeline__card">
          <div class="timeline__header">
            <span class="timeline__title timeline__title--log">Work</span>
            <span class="timeline__meta">{{ entry|log_entry_meta }}</span>
          </div>
          <div class="timeline__body {% if entry.problem_report or entry.media.all %}space-below-sm{% endif %} markdown-content markdown-content--compact">
            {{ entry.text|render_markdown }}
          </div>
          {% if entry.media.all %}
            <div class="flex flex-wrap stack-tight space-above-sm">
              {% for media in entry.media.all %}
                {% if media.media_type == 'video' %}
                  {% if media.transcode_status == 'ready' and media.poster_file %}
                    <img src="{{ media.poster_file.url }}" alt="Video poster" width="120">
                  {% elif media.transcode_status == 'processing' or media.transcode_status == 'pending' %}
                    <span class="text-muted body-small">Video processingâ€¦</span>
                  {% else %}
                    <span class="text-problem body-small">Video failed</span>
                  {% endif %}
                {% else %}
                  {% if media.thumbnail_file %}
                    <img src="{{ media.thumbnail_file.url }}" alt="Photo" width="120">
                  {% else %}
                    <img src="{{ media.file.url }}" alt="Photo" width="120">
                  {% endif %}
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}
          {% if entry.problem_report %}
            <div class="snippet-row">
              <span class="snippet-label text-problem">
                <i class="fa-solid fa-bug space-right-xs"></i>Problem:
              </span>
              <span class="snippet-text">{{ entry.problem_report|problem_report_summary }}</span>
            </div>
          {% endif %}
        </div>
      </div>
    </a>
  </div>
{% elif entry.entry_type == "problem_report" %}
  <div class="timeline__entry">
    <a href="{% url 'problem-report-detail' entry.pk %}"
       class="timeline__entry-inner">
      <div class="timeline__icon timeline__icon--problem">
        <i class="fa-solid fa-bug"></i>
      </div>
      <div class="timeline__content">
        <div class="card card--problem timeline__card">
          <div class="timeline__header">
            <div class="flex items-center stack-tight">
              <span class="timeline__title timeline__title--problem">Problem</span>
              <span class="badge {% if entry.status == 'open' %}badge--warning{% else %}badge--success{% endif %}">
                {{ entry.get_status_display }}
              </span>
            </div>
            <span class="timeline__meta">{{ entry|problem_report_meta }}</span>
          </div>
          <div class="timeline__body {% if entry.prefetched_log_entries %}space-below-sm{% endif %} markdown-content markdown-content--compact">
            {% if entry.description %}
              {{ entry.description|render_markdown }}
            {% else %}
              {{ entry|problem_report_summary }}
            {% endif %}
          </div>
          {% if entry.prefetched_log_entries %}
            {% with latest_log=entry.prefetched_log_entries.0 %}
              <div class="snippet-row">
                <span class="snippet-label text-log">
                  <i class="fa-solid fa-screwdriver-wrench space-right-xs"></i>Latest:
                </span>
                <span class="snippet-text">{{ latest_log.text|truncatewords:15 }}</span>
              </div>
            {% endwith %}
          {% endif %}
        </div>
      </div>
    </a>
  </div>
{% endif %}
