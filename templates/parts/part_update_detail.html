{% extends "layouts/two_column.html" %}
{% load static core_extras %}
{% block title %}
  {% if part_request.machine %}{{ part_request.machine.short_display_name }} 路{% endif %}
  Parts Request #{{ part_request.pk }} 路 Update #{{ update.pk }} 路 {{ block.super }}
{% endblock %}
{% block breadcrumbs %}
  {% if part_request.machine %}
    <a href="{% url 'maintainer-machine-list' %}">Machines</a>
    <a href="{% url 'maintainer-machine-detail' part_request.machine.slug %}">{{ part_request.machine.short_display_name }}</a>
    <a href="{% url 'maintainer-machine-detail' part_request.machine.slug %}?f=parts">Parts</a>
    <a href="{% url 'part-request-detail' part_request.pk %}">#{{ part_request.pk }}</a>
    <span>{% icon "comment" %} Update</span>
  {% else %}
    <a href="{% url 'part-request-list' %}">Parts Requests</a>
    <a href="{% url 'part-request-detail' part_request.pk %}">#{{ part_request.pk }}</a>
    <span>{% icon "comment" %} Update</span>
  {% endif %}
{% endblock %}
{% block mobile_actions %}
  <div class="mobile-meta">
    {# Part Request info #}
    <div class="mobile-meta__row">
      <span class="pill pill--neutral">{{ part_request.get_status_display }}</span>
      {% if part_request.machine %}
        <span class="text-muted text-sm">{{ part_request.machine.short_display_name }}</span>
      {% endif %}
    </div>
    {# Update info #}
    <div class="mobile-meta__row text-muted text-sm">
      This update posted by {{ update.poster_display }} on {{ update.occurred_at|smart_date }}
    </div>
  </div>
  <a href="{% url 'part-request-update-edit' update.pk %}"
     class="btn btn--secondary btn--full">{% icon "pen" class="meta" label="Edit Details" %}</a>
{% endblock %}
{% block sidebar %}
  {% include "components/history_link.html" with history_url=update.get_admin_history_url %}
  {% sidebar_section label="Parts Request" %}
  <a href="{% url 'part-request-detail' part_request.pk %}"
     class="sidebar__title sidebar__link">{% icon "box-open" %} #{{ part_request.pk }}</a>
  <div class="flex flex-wrap stack-tight space-above-sm">
    <span class="pill pill--neutral">{{ part_request.get_status_display }}</span>
  </div>
{% endsidebar_section %}
{% if part_request.machine %}
  {% sidebar_section label="Machine" %}
  {% include "components/machine_sidebar_card.html" with machine=part_request.machine %}
{% endsidebar_section %}
{% endif %}
{% sidebar_section label="Posted" %}
<div class="sidebar__subtitle">{{ update.poster_display }} 路 {{ update.occurred_at|smart_date }}</div>
{% endsidebar_section %}
{% if update.new_status %}
  {% sidebar_section label="Status Change" %}
  <div class="sidebar__subtitle">
    This update changed the status of the parts request to: <span class="pill pill--neutral">{{ update.get_new_status_display }}</span>
  </div>
{% endsidebar_section %}
{% endif %}
{% sidebar_section %}
<a href="{% url 'part-request-update-edit' update.pk %}"
   class="btn btn--secondary btn--full">
  {% icon "pen" class="meta" %}
  Edit Details
</a>
{% endsidebar_section %}
{% endblock %}
{% block main %}
  <!-- DESCRIPTION CARD -->
  {% include "core/partials/text_card_editable.html" with content=update.text %}
  <!-- MEDIA CARD -->
  {% include "core/partials/media_card_editable.html" with media_items=update.media.all alt="Update photo" model_name="PartRequestUpdateMedia" %}
{% endblock %}
{% block extra_scripts %}
  {% include "core/partials/markdown_textarea_scripts.html" %}
  {% include "core/partials/markdown_inline_edit_scripts.html" %}
  <script src="{% static 'core/media_grid.js' %}" defer></script>
  <script src="{% static 'core/video_transcode_poll.js' %}" defer></script>
{% endblock %}
