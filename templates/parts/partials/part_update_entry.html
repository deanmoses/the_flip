{% load core_extras %}
<article class="card card--padded card--log js-clickable-card"
         data-url="{% url 'part-request-update-detail' update.pk %}"
         tabindex="0"
         role="button"
         aria-label="View update">
  <div class="flex items-center justify-between stack-tight">
    <div class="flex items-center stack-tight">
      <i class="fa-solid fa-comment text-log"></i>
    </div>
    <div class="log-entry-meta">
      {{ update.posted_by.display_name }} Â· <strong>{{ update.created_at|smart_date }}</strong>
      {% if update.new_status %}<span class="pill pill--neutral">-> {{ update.get_new_status_display }}</span>{% endif %}
    </div>
  </div>
  <div class="space-above-sm">
    <div class="markdown-content markdown-content--compact">{{ update.text|render_markdown }}</div>
    {% if update.media.all %}
      <div class="flex flex-wrap stack-tight space-above-sm">
        {% for media in update.media.all %}
          {% if media.media_type == 'video' %}
            {% if media.transcode_status == 'ready' and media.poster_file %}
              <img src="{{ media.poster_file.url }}" alt="Video poster" width="160">
            {% elif media.transcode_status == 'processing' or media.transcode_status == 'pending' %}
              <span class="text-muted body-small">Video processing...</span>
            {% else %}
              <span class="text-problem body-small">Video failed</span>
            {% endif %}
          {% else %}
            {% if media.thumbnail_file %}
              <img src="{{ media.thumbnail_file.url }}" alt="Photo" width="160">
            {% else %}
              <img src="{{ media.file.url }}" alt="Photo" width="160">
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}
  </div>
</article>
