{% load core_extras %}
{% timeline_entry icon="box-open" variant="log" %}
<div class="card card--log timeline__card">
  <a href="{% url 'part-request-detail' entry.pk %}"
     class="timeline__card-link">
    <div class="timeline__header">
      <div class="flex items-center stack-tight">
        <span class="timeline__title">
          {% if entry.machine %}
            {{ entry.machine.name }} – Parts Request #{{ entry.pk }}
          {% else %}
            Parts Request #{{ entry.pk }}
          {% endif %}
        </span>
        <span class="pill pill--neutral">{{ entry.get_status_display }}</span>
      </div>
      <span class="timeline__meta">{{ entry.requester_display }} · <strong>{{ entry.created_at|smart_date }}</strong></span>
    </div>
  </a>
  <div class="timeline__body {% if entry.prefetched_updates or entry.media.all %}space-below-sm{% endif %} markdown-content markdown-content--compact">
    {{ entry.text|truncatechars:200|render_markdown }}
  </div>
  {% url 'part-request-detail' entry.pk as entry_url %}
  {% include "core/partials/media_grid_readonly.html" with media_items=entry.media.all detail_url=entry_url model_name="PartRequestMedia" %}
  {% if entry.prefetched_updates %}
    {% with latest_update=entry.prefetched_updates.0 %}
      <a href="{% url 'part-request-update-detail' latest_update.pk %}"
         class="timeline__snippet-link">
        <span class="snippet-label text-log">{% icon "comment" class="space-right-xs" %}Latest:</span>
        <span class="snippet-text">{{ latest_update.text|truncatewords:15 }}</span>
      </a>
    {% endwith %}
  {% endif %}
</div>
{% endtimeline_entry %}
