{% extends "layouts/two_column.html" %}
{% load core_extras %}
{% block title %}Add Machine Â· {{ block.super }}{% endblock %}
{% block breadcrumbs %}
  <a href="{% url 'maintainer-machine-list' %}">Machines</a>
  <span>Add Machine</span>
{% endblock %}
{% block mobile_actions %}
  <a href="{% url 'maintainer-machine-list' %}" class="btn btn--secondary">
    {% icon "arrow-left" class="meta" %}
    Back to Machines
  </a>
{% endblock %}
{% block sidebar %}
  {% sidebar_section label="Add Machine" %}
  <p class="sidebar__meta">Add a new machine to the collection</p>
{% endsidebar_section %}
{% sidebar_section %}
<a href="{% url 'maintainer-machine-list' %}"
   class="btn btn--secondary btn--full">
  {% icon "arrow-left" class="meta" %}
  Back to Machines
</a>
{% endsidebar_section %}
{% endblock %}
{% block main %}
  <div class="card card--padded">
    <form method="post" class="form-main">
      {% csrf_token %}
      {% form_non_field_errors form %}
      <fieldset class="form-section">
        <legend>Machine Information</legend>
        {% form_field form.model %}
        {% form_field form.model_name id="field-model-name" class_="hidden" %}
        {% form_field form.manufacturer id="field-manufacturer" class_="hidden" %}
        {% form_field form.year id="field-year" class_="hidden" %}
        {% form_field form.name_override id="field-name-override" class_="hidden" %}
      </fieldset>
      <div class="form-actions">
        <a href="{% url 'maintainer-machine-list' %}" class="btn btn--secondary">
          {% icon "circle-xmark" class="meta" %}
          Cancel
        </a>
        <button type="submit" class="btn btn--log">
          {% icon "plus" class="meta" %}
          Create Machine
        </button>
      </div>
    </form>
  </div>
{% endblock %}
{% block extra_scripts %}
  <script>
    (function() {
      const modelSelect = document.getElementById('{{ form.model.id_for_label }}');
      const modelNameField = document.getElementById('field-model-name');
      const manufacturerField = document.getElementById('field-manufacturer');
      const yearField = document.getElementById('field-year');
      const nameOverrideField = document.getElementById('field-name-override');

      function updateFieldVisibility() {
        const isCreatingNewModel = !modelSelect.value;

        // Show/hide fields based on whether creating new model or selecting existing
        if (isCreatingNewModel) {
          // Show new model fields
          modelNameField.classList.remove('hidden');
          manufacturerField.classList.remove('hidden');
          yearField.classList.remove('hidden');
          // Hide name override
          nameOverrideField.classList.add('hidden');
        } else {
          // Hide new model fields
          modelNameField.classList.add('hidden');
          manufacturerField.classList.add('hidden');
          yearField.classList.add('hidden');
          // Show name override
          nameOverrideField.classList.remove('hidden');
        }
      }

      // Initialize on page load
      updateFieldVisibility();

      // Update when selection changes
      modelSelect.addEventListener('change', updateFieldVisibility);
    })();
  </script>
{% endblock %}
