{% load ui_tags %}
{% load catalog_tags %}
{% load maintenance_tags %}
<article class="machine-card"
         data-search-text="{{ machine.name }} {{ machine.model.year }} {{ machine.model.manufacturer }} {{ machine.get_operational_status_display }}{% if machine.location %} {{ machine.location.name }}{% endif %}{% if machine.latest_open_report %} {{ machine.latest_open_report.0.description }}{% endif %}">
  <a href="{% url 'maintainer-machine-detail' machine.slug %}"
     class="machine-card__link">
    <span class="machine-card__title">{{ machine.name }}</span>
    <div class="machine-card__pills">
      <span class="pill {{ machine.operational_status|machine_status_css_class }}">
        {% icon machine.operational_status|machine_status_icon class="meta" %}
        {{ machine.get_operational_status_display }}
      </span>
      {% if machine.location %}
        <span class="pill pill--neutral">
          {% icon "location-dot" class="meta" %}
          {{ machine.location.name }}
        </span>
      {% endif %}
    </div>
  </a>
  <div class="machine-card__actions">
    {% report_problem_button machine btn_class="btn btn--secondary btn--sm" %}
    {% if user.is_authenticated %}
      <a href="{% url 'log-create-machine' machine.slug %}"
         class="btn btn--secondary btn--sm"
         title="Log maintenance work">
        {% icon "screwdriver-wrench" %}
        <span class="machine-card__btn-text--short">Log</span>
        <span class="machine-card__btn-text--long">Log Work</span>
      </a>
    {% endif %}
  </div>
  {% if machine.latest_open_report %}
    <a href="{% url 'problem-report-detail' machine.latest_open_report.0.pk %}"
       class="machine-card__problem">
      <span class="snippet-label text-problem">{% icon "bug" %}Problem:</span>
      <span class="snippet-text">{{ machine.latest_open_report.0|problem_report_summary }}</span>
    </a>
  {% endif %}
</article>
