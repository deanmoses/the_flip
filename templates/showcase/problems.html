{% extends "base_showcase.html" %}
{% load ui_tags %}
{% block title %}Problems Â· {{ block.super }}{% endblock %}
{% block content %}
  <div data-expandable-search>
    <div class="expandable-search__toggle{% if query %} hidden{% endif %}">
      <button type="button"
              class="btn btn--secondary btn--sm"
              aria-label="Search problems">{% icon "magnifying-glass" %}</button>
    </div>
    <div class="filter-bar{% if not query %} hidden{% endif %}">
      <div class="filter-bar__search filter-bar__search--full">
        <form method="get" action="">
          <input type="search"
                 name="q"
                 placeholder="Search problems..."
                 value="{{ search_form.q.value|default:'' }}"
                 class="filter-bar__search-input">
          {% icon "magnifying-glass" class="filter-bar__search-icon" %}
        </form>
      </div>
    </div>
  </div>
  {% if columns %}
    {% include "core/partials/column_grid.html" with card_template=card_template empty_message="No open problems." %}
  {% elif query %}
    <p class="text-muted">No open problems match your search.</p>
  {% else %}
    <p class="text-muted">No open problems.</p>
  {% endif %}
{% endblock %}
{% block extra_scripts %}
  <script>
    (function () {
      'use strict';
      document.querySelectorAll('[data-expandable-search]').forEach(function (container) {
        const toggle = container.querySelector('.expandable-search__toggle');
        const bar = container.querySelector('.filter-bar');
        const input = bar.querySelector('input[type="search"]');
        function openSearch() {
          toggle.classList.add('hidden');
          bar.classList.remove('hidden');
          input.focus();
        }
        function closeSearch() {
          if (new URLSearchParams(window.location.search).has('q')) {
            window.location.href = window.location.pathname;
            return;
          }
          input.value = '';
          bar.classList.add('hidden');
          toggle.classList.remove('hidden');
        }
        toggle.querySelector('button').addEventListener('click', openSearch);
        if (input.value) {
          input.focus();
          input.setSelectionRange(input.value.length, input.value.length);
        }
        input.addEventListener('keydown', function (e) {
          if (e.key === 'Escape') {
            e.preventDefault();
            closeSearch();
          }
        });
      });
    })();
  </script>
{% endblock %}
