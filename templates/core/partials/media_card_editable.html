{# Editable media card with upload button, grid, and file input #}
{# Usage: {% include "core/partials/media_card_editable.html" with media_items=entry.media.all alt="Log entry photo" %} #}
{# Requires: Include media_grid.js in page scripts #}
<div class="card card--padded space-above-lg"
     data-media-card
     data-alt-text="{{ alt|default:'Photo' }}">
  <div class="card__header">
    <div class="card__title">Media</div>
    <div class="card__actions">
      <button type="button"
              class="btn btn--secondary btn--sm"
              data-media-upload-btn>Upload Photos</button>
    </div>
  </div>
  <div class="media-grid" data-media-container>
    {% if media_items %}
      {% for media in media_items %}
        <div class="media-grid__item" data-media-id="{{ media.id }}">
          {% if media.media_type == 'video' %}
            {% if media.transcode_status == 'ready' and media.transcoded_file %}
              <video controls poster="{{ media.poster_file.url }}">
                <source src="{{ media.transcoded_file.url }}" type="video/mp4">
                Your browser doesn't support video playback.
              </video>
            {% elif media.transcode_status == 'processing' or media.transcode_status == 'pending' %}
              <div class="media-grid__status">Processing video…</div>
            {% else %}
              <div class="media-grid__status media-grid__status--error">Video processing failed.</div>
            {% endif %}
          {% else %}
            <a href="{{ media.file.url }}" target="_blank">
              {% if media.thumbnail_file %}
                <img src="{{ media.thumbnail_file.url }}" alt="{{ alt|default:'Photo' }}">
              {% else %}
                <img src="{{ media.file.url }}" alt="{{ alt|default:'Photo' }}">
              {% endif %}
            </a>
          {% endif %}
          <button type="button"
                  class="media-grid__delete"
                  data-media-id="{{ media.id }}"
                  aria-label="Delete media">×</button>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-muted" data-no-media-message>No media.</p>
    {% endif %}
  </div>
  <input type="file"
         accept="image/*,video/*,.heic,.heif,image/heic,image/heif"
         multiple
         class="hidden"
         data-media-file-input>
</div>
