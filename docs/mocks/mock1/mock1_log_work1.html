<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Flip - Log Work Form</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"
          rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom Palette - Theme 1 (Light) and Dark 3 */
        :root {
            --color-background: #FBF7F0;
            --color-surface: #FFFFFF;
            --color-text-dark: #333333;
            --color-text-muted: #6b7280;
            --color-accent-amber: #F59E0B;
            --color-border-soft: #E7E5E4;

            /* Log / Work Theme (Blue) */
            --color-log-base: #1D4ED8;
            --color-log-hover: #1E40AF;
            --color-log-light-bg: #F0F9FF;
            --color-log-light-border: #93C5FD;

            /* Problem Theme (Red) */
            --color-problem-base: #DC2626;
            --color-problem-hover: #B91C1C;
            --color-problem-light-bg: #FEF2F2;
            --color-problem-light-border: #FCA5A5;

            /* Form-specific */
            --color-input-border: #d1d5db;
            --color-input-focus: #3b82f6;
            --color-input-bg: #ffffff;
        }

        /* Dark 3 Theme */
        body[data-theme="dark3"] {
            --color-background: #1f1f1f;
            --color-surface: #252525;
            --color-text-dark: #cccccc;
            --color-text-muted: #9ca3af;
            --color-accent-amber: #0078d4;
            --color-border-soft: #2b2b2b;
            --color-log-base: #0078d4;
            --color-log-hover: #026ec1;
            --color-log-light-bg: #181818;
            --color-log-light-border: #2b2b2b;
            --color-problem-base: #f85149;
            --color-problem-hover: #e64545;
            --color-problem-light-bg: #2b2b2b;
            --color-problem-light-border: #616161;
            --color-input-border: #404040;
            --color-input-focus: #0078d4;
            --color-input-bg: #2b2b2b;
            --color-secondary-bg: #3a3a3a;
            --color-secondary-text: #e5e7eb;
            --color-secondary-border: #4a4a4a;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text-dark);
            overflow-x: hidden;
            background-image: linear-gradient(0deg, rgba(0, 0, 0, .01) 50%, transparent 50%), linear-gradient(90deg, rgba(0, 0, 0, .01) 50%, transparent 50%);
            background-size: 4px 4px;
        }

        .card-style {
            background-color: var(--color-surface);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--color-border-soft);
        }

        .button-style {
            border-radius: 8px;
            transition: all 0.15s ease-in-out;
        }

        .button-style:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .log-button {
            background-color: var(--color-log-base);
        }

        .log-button:hover {
            background-color: var(--color-log-hover);
        }

        .brand-logo {
            height: 64px;
            width: auto;
            display: block;
        }

        .app-header {
            background: var(--color-surface);
            color: var(--color-text-dark);
        }

        .nav-active {
            color: var(--color-accent-amber);
            border-bottom: 2px solid var(--color-accent-amber);
        }

        .nav-link {
            color: var(--color-text-dark);
            border-bottom: 2px solid transparent;
        }

        .nav-link:hover {
            color: var(--color-accent-amber);
            border-bottom-color: var(--color-border-soft);
        }

        /* Form Styles */
        .form-input {
            background-color: var(--color-input-bg);
            border: 1px solid var(--color-input-border);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            width: 100%;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
            color: var(--color-text-dark);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-input-focus);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }

        .form-input::placeholder {
            color: var(--color-text-muted);
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--color-text-dark);
        }

        .form-hint {
            font-size: 0.875rem;
            color: var(--color-text-muted);
            margin-top: 0.25rem;
        }

        textarea.form-input {
            min-height: 150px;
            resize: vertical;
        }

        /* Problem report link card */
        .linked-problem-card {
            background-color: var(--color-problem-light-bg);
            border: 1px solid var(--color-problem-light-border);
            border-radius: 8px;
            padding: 1rem;
        }

        .problem-color-text {
            color: var(--color-problem-base);
        }

        .log-color-text {
            color: var(--color-log-base);
        }

        /* File upload */
        .file-upload-area {
            border: 2px dashed var(--color-border-soft);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.15s ease, background-color 0.15s ease;
        }

        .file-upload-area:hover {
            border-color: var(--color-log-base);
            background-color: var(--color-log-light-bg);
        }

        /* Pill Styles */
        .pill-style {
            border-radius: 9999px;
            padding: 0.4rem 1rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            line-height: 1;
        }

        .status-pill-fixing {
            background-color: #FEF3C7;
            color: #B45309;
            border: 1px solid #FCD34D;
        }

        /* Theme switcher */
        .theme-switcher {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            background: var(--color-surface);
            border: 1px solid var(--color-border-soft);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            border-radius: 9999px;
            padding: 0.35rem 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 40;
            font-size: 0.9rem;
        }

        .theme-switcher button {
            border: none;
            background: transparent;
            padding: 0.2rem 0.6rem;
            border-radius: 9999px;
            cursor: pointer;
            color: var(--color-text-dark);
            font-weight: 600;
            transition: background 0.15s ease, color 0.15s ease;
        }

        .theme-switcher button:hover {
            background: var(--color-border-soft);
        }

        .theme-switcher button.is-active {
            background: var(--color-accent-amber);
            color: #fff;
        }

        /* Dark theme text overrides */
        body[data-theme="dark3"] h1,
        body[data-theme="dark3"] h2,
        body[data-theme="dark3"] h3,
        body[data-theme="dark3"] .text-gray-800,
        body[data-theme="dark3"] .text-gray-700,
        body[data-theme="dark3"] .text-gray-600 {
            color: #e5e7eb !important;
        }

        body[data-theme="dark3"] .text-gray-500,
        body[data-theme="dark3"] .text-gray-400 {
            color: #9ca3af !important;
        }

        /* Dark mode: fix secondary buttons and pills */
        body[data-theme="dark3"] .bg-gray-100 {
            background-color: var(--color-secondary-bg) !important;
        }

        body[data-theme="dark3"] .text-gray-700 {
            color: var(--color-secondary-text) !important;
        }

        body[data-theme="dark3"] .border-gray-300 {
            border-color: var(--color-secondary-border) !important;
        }

        /* Main content needs padding for the fixed header */
        #main-content {
            padding-top: 5rem;
        }
    </style>
  </head>
  <body>
    <!-- === PERSISTENT SITE HEADER === -->
    <header class="app-header fixed top-0 w-full border-b border-gray-200 z-30 p-3 shadow-sm flex justify-between items-center h-16">
      <a href="#" class="flex items-center gap-2 shrink-0">
        <img src="../../the_flip/static/core/images/logo_blue.svg"
             data-logo-default="../../the_flip/static/core/images/logo_blue.svg"
             data-logo-inverse="../../the_flip/static/core/images/logo_white.svg"
             alt="The Flip"
             class="brand-logo">
      </a>
      <nav class="hidden md:flex gap-4 text-base font-medium">
        <a href="#" class="px-3 py-1 font-bold nav-active">Machines</a>
        <a href="#" class="px-3 py-1 nav-link">Problem Reports</a>
        <a href="#" class="px-3 py-1 nav-link">Logs</a>
        <a href="#" class="px-3 py-1 nav-link text-gray-500">Admin</a>
      </nav>
      <div class="flex items-center gap-4 relative">
        <div id="account-dropdown-toggle"
             class="hidden md:flex w-9 h-9 bg-amber-600 text-white rounded-full items-center justify-center font-bold text-sm cursor-pointer"
             onclick="toggleAccountMenu()">PW</div>
        <div id="account-menu"
             class="hidden absolute right-0 top-10 w-48 bg-white card-style p-3 shadow-xl text-base z-50">
          <p class="text-sm text-gray-500 mb-2">PinballWizard99</p>
          <a href="#" class="block p-2 hover:bg-gray-50 rounded-lg"><i class="fa-solid fa-gear mr-2"></i> Manage Account</a>
          <a href="#" class="block p-2 hover:bg-gray-50 rounded-lg text-red-600"><i class="fa-solid fa-right-from-bracket mr-2"></i> Logout</a>
        </div>
        <button class="md:hidden text-2xl text-gray-700" onclick="toggleMobileMenu()">
          <i class="fa-solid fa-bars"></i>
        </button>
      </div>
    </header>
    <!-- === MOBILE MENU DRAWER === -->
    <div id="mobile-menu-drawer"
         class="fixed top-0 right-0 w-64 h-full bg-white shadow-xl pt-16 flex flex-col justify-between hidden md:hidden z-50">
      <div class="px-4 space-y-1 text-base font-semibold overflow-y-auto pt-2">
        <a href="#"
           class="block p-2 hover:bg-amber-50 rounded-lg text-amber-700"><i class="fa-solid fa-list mr-2"></i> Machines</a>
        <a href="#" class="block p-2 hover:bg-gray-50 rounded-lg text-gray-700"><i class="fa-solid fa-triangle-exclamation mr-2"></i> Problems</a>
        <a href="#" class="block p-2 hover:bg-gray-50 rounded-lg text-gray-700"><i class="fa-solid fa-screwdriver-wrench mr-2"></i> Global Logs</a>
        <a href="#" class="block p-2 hover:bg-gray-50 rounded-lg text-gray-500"><i class="fa-solid fa-users mr-2"></i> Admin Panel</a>
      </div>
      <div class="px-4 py-3 border-t border-gray-200">
        <div class="card-style p-3 bg-gray-50 text-sm mb-3">
          <p class="font-bold">Logged in as:</p>
          <p class="text-gray-600">PinballWizard99</p>
        </div>
        <a href="#" class="block p-2 hover:bg-gray-50 rounded-lg text-gray-700"><i class="fa-solid fa-gear mr-2"></i> Account Settings</a>
        <a href="#"
           class="block p-2 hover:bg-gray-50 rounded-lg text-red-600 font-semibold"><i class="fa-solid fa-right-from-bracket mr-2"></i> Logout</a>
      </div>
      <button onclick="toggleMobileMenu()"
              class="text-gray-500 text-sm p-3 border-t hover:bg-gray-50">
        Close Menu <i class="fa-solid fa-xmark ml-1"></i>
      </button>
    </div>
    <!-- === OVERLAY === -->
    <div id="overlay"
         class="fixed inset-0 hidden md:hidden bg-black opacity-30 z-40"
         onclick="toggleMobileMenu()"></div>
    <!-- === MAIN CONTENT === -->
    <main id="main-content" class="p-4 lg:p-8 max-w-5xl mx-auto relative">
      <!-- BREADCRUMBS -->
      <div class="text-gray-500 mb-4 flex items-center gap-2 text-sm lg:text-base">
        <a href="#" class="text-gray-500 hover:text-amber-600 transition">Machines</a>
        <span>/</span>
        <a href="#" class="text-gray-500 hover:text-amber-600 transition">The Addams Family</a>
        <span>/</span>
        <a href="#" class="text-gray-500 hover:text-amber-600 transition">Problem #47</a>
        <span>/</span>
        <span class="font-semibold text-gray-700">Log Work</span>
      </div>
      <!-- MACHINE CONTEXT HEADER -->
      <div class="card-style p-6 mb-6">
        <h1 class="text-4xl lg:text-5xl font-extrabold text-gray-800">Log Work on The Addams Family</h1>
        <div class="flex flex-wrap items-center gap-3 mt-4">
          <!-- Status Pill -->
          <span class="pill-style status-pill-fixing">
            <i class="fa-solid fa-wrench"></i>
            <span class="font-semibold">Fixing</span>
          </span>
          <!-- Location Pill -->
          <span class="pill-style bg-gray-100 text-gray-700 border border-gray-300">
            <i class="fa-solid fa-location-dot"></i>
            <span class="font-semibold">Workshop</span>
          </span>
        </div>
        <!-- LINKED PROBLEM REPORT (shown when logging against a problem) -->
        <div class="linked-problem-card mt-6">
          <div class="flex items-start gap-3">
            <i class="fa-solid fa-bug problem-color-text text-lg mt-0.5"></i>
            <div class="flex-1">
              <span class="font-semibold problem-color-text">Problem Report #47</span>
              <p class="text-gray-700 text-sm mt-1">Top right flipper barely moves when I hit the button. Ball gets stuck.</p>
              <p class="text-gray-500 text-xs mt-1">Reported by Visitor &bull; Yesterday 10:15am</p>
            </div>
          </div>
        </div>
      </div>
      <!-- FORM CARD (full width to match header) -->
      <form class="card-style p-6 space-y-6">
        <!-- WORK DESCRIPTION -->
        <div>
          <label for="description" class="form-label">
            What work was done? <span class="text-red-500">*</span>
          </label>
          <textarea id="description"
                    name="description"
                    class="form-input"
                    placeholder="Describe the work performed..."
                    required>Replaced the coil on the upper right flipper. It was showing resistance issues. Test played one game, feels snappy now.</textarea>
        </div>
        <!-- PHOTOS/VIDEOS -->
        <div>
          <label class="form-label">Photos</label>
          <div class="file-upload-area">
            <i class="fa-solid fa-cloud-arrow-up text-3xl text-gray-400 mb-2"></i>
            <p class="text-gray-600 font-medium">Drop photos here or click to upload</p>
            <input type="file" class="hidden" multiple accept="image/*,video/*">
          </div>
          <!-- Uploaded files preview (example) -->
          <div class="mt-3 flex gap-2 flex-wrap">
            <div class="relative group">
              <div class="w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center">
                <i class="fa-solid fa-image text-gray-400 text-2xl"></i>
              </div>
              <button type="button"
                      class="absolute -top-2 -right-2 w-5 h-5 bg-red-500 text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition">
                <i class="fa-solid fa-xmark"></i>
              </button>
            </div>
          </div>
        </div>
        <!-- WORK DATE + MAINTAINERS (side by side on desktop, stacked on mobile) -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- WORK DATE (Optional - defaults to now) -->
          <div>
            <label for="work_date" class="form-label">When was this work?</label>
            <input type="datetime-local"
                   id="work_date"
                   name="work_date"
                   class="form-input">
          </div>
          <!-- ADDITIONAL MAINTAINERS -->
          <div>
            <label for="maintainers" class="form-label">Who did the work?</label>
            <div class="flex flex-wrap gap-2 mb-2">
              <!-- Selected maintainer chips -->
              <span class="inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
                TechSam
                <button type="button" class="hover:text-blue-600">
                  <i class="fa-solid fa-xmark text-xs"></i>
                </button>
              </span>
            </div>
            <input type="text"
                   id="maintainers"
                   name="maintainers"
                   class="form-input"
                   placeholder="Search for users or write a custom name...">
          </div>
        </div>
        <!-- CLOSE PROBLEM OPTION (shown when linked to a problem) -->
        <div class="bg-green-50 border border-green-200 rounded-lg p-4 flex items-start gap-3">
          <input type="checkbox"
                 id="close_problem"
                 name="close_problem"
                 class="mt-1 w-5 h-5 text-green-600 rounded">
          <div>
            <label for="close_problem"
                   class="font-semibold text-green-800 cursor-pointer">Close the problem report</label>
            <p class="text-green-700 text-sm mt-0.5">Did this work fix the problem report?</p>
          </div>
        </div>
        <!-- FORM ACTIONS -->
        <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-200">
          <button type="submit"
                  class="button-style log-button text-white px-6 py-3 text-lg font-bold flex items-center justify-center gap-2 flex-1 sm:flex-none">
            <i class="fa-solid fa-check"></i>
            Log It
          </button>
          <a href="#"
             class="button-style bg-gray-100 text-gray-700 px-6 py-3 text-lg font-semibold flex items-center justify-center gap-2 border border-gray-300 hover:bg-gray-200">
            Cancel
          </a>
        </div>
      </form>
    </main>
    <!-- Theme Switcher (for demo only) -->
    <div class="theme-switcher">
      <button data-theme="default" class="is-active">Light</button>
      <button data-theme="dark3">Dark</button>
    </div>
    <script>
      // Desktop Account Dropdown
      function toggleAccountMenu() {
        const menu = document.getElementById('account-menu');
        menu.classList.toggle('hidden');
      }

      // Mobile Menu Drawer
      function toggleMobileMenu() {
        const drawer = document.getElementById('mobile-menu-drawer');
        const overlay = document.getElementById('overlay');
        drawer.classList.toggle('hidden');
        overlay.classList.toggle('hidden');
        document.body.classList.toggle('drawer-open');
        document.getElementById('account-menu').classList.add('hidden');
      }

      // Close menu on outside click
      document.addEventListener('click', function(event) {
        const desktopMenu = document.getElementById('account-menu');
        const toggle = document.getElementById('account-dropdown-toggle');
        if (desktopMenu && toggle && window.innerWidth >= 768) {
          if (!desktopMenu.contains(event.target) && !toggle.contains(event.target)) {
            desktopMenu.classList.add('hidden');
          }
        }
      });

      // File upload click handler
      document.querySelector('.file-upload-area').addEventListener('click', function() {
        this.querySelector('input[type="file"]').click();
      });

      // Theme switching
      (function() {
        const buttons = document.querySelectorAll('.theme-switcher button');
        const logo = document.querySelector('.brand-logo');

        function setTheme(theme) {
          document.body.setAttribute('data-theme', theme);
          buttons.forEach(btn => {
            btn.classList.toggle('is-active', btn.dataset.theme === theme);
          });
          if (logo) {
            if (theme === 'dark3') {
              logo.src = logo.dataset.logoInverse || logo.src;
            } else {
              logo.src = logo.dataset.logoDefault || logo.src;
            }
          }
        }

        buttons.forEach(btn => {
          btn.addEventListener('click', () => setTheme(btn.dataset.theme));
        });

        setTheme('default');
      })();

      // Set current datetime in the work_date field
      (function() {
        const dateInput = document.getElementById('work_date');
        if (dateInput) {
          const now = new Date();
          // Format as YYYY-MM-DDTHH:MM for datetime-local input
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const day = String(now.getDate()).padStart(2, '0');
          const hours = String(now.getHours()).padStart(2, '0');
          const minutes = String(now.getMinutes()).padStart(2, '0');
          dateInput.value = `${year}-${month}-${day}T${hours}:${minutes}`;
        }
      })();
    </script>
  </body>
</html>
