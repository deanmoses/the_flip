<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Flip - Log Work Form (Sidebar Layout)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"
          rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom Palette - Light Theme and Dark Theme */
        :root {
            --color-background: #FBF7F0;
            --color-surface: #FFFFFF;
            --color-text-dark: #333333;
            --color-text-muted: #6b7280;
            --color-accent-amber: #F59E0B;
            --color-border-soft: #E7E5E4;

            /* Work Log Theme */
            --color-log-base: #1D4ED8;
            --color-log-hover: #1E40AF;
            --color-log-light-bg: #F0F9FF;
            --color-log-light-border: #93C5FD;

            /* Problem Report Theme */
            --color-problem-base: #DC2626;
            --color-problem-hover: #B91C1C;
            --color-problem-light-bg: #FEF2F2;
            --color-problem-light-border: #FCA5A5;

            /* Form-specific */
            --color-input-border: #d1d5db;
            --color-input-focus: #3b82f6;
            --color-input-bg: #ffffff;
        }

        /* Dark Theme */
        body[data-theme="dark3"] {
            --color-background: #1f1f1f;
            --color-surface: #252525;
            --color-text-dark: #cccccc;
            --color-text-muted: #9ca3af;
            --color-accent-amber: #0078d4;
            --color-border-soft: #2b2b2b;
            --color-log-base: #0078d4;
            --color-log-hover: #026ec1;
            --color-log-light-bg: #181818;
            --color-log-light-border: #2b2b2b;
            --color-problem-base: #f85149;
            --color-problem-hover: #e64545;
            --color-problem-light-bg: #2b2b2b;
            --color-problem-light-border: #616161;
            --color-input-border: #404040;
            --color-input-focus: #0078d4;
            --color-input-bg: #2b2b2b;
            --color-secondary-bg: #3a3a3a;
            --color-secondary-text: #e5e7eb;
            --color-secondary-border: #4a4a4a;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text-dark);
            overflow-x: hidden;
            background-image: linear-gradient(0deg, rgba(0, 0, 0, .01) 50%, transparent 50%), linear-gradient(90deg, rgba(0, 0, 0, .01) 50%, transparent 50%);
            background-size: 4px 4px;
        }

        .card-style {
            background-color: var(--color-surface);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--color-border-soft);
        }

        .button-style {
            border-radius: 8px;
            transition: all 0.15s ease-in-out;
        }

        .button-style:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .log-button {
            background-color: var(--color-log-base);
        }

        .log-button:hover {
            background-color: var(--color-log-hover);
        }

        .brand-logo {
            height: 64px;
            width: auto;
            display: block;
        }

        .app-header {
            background: var(--color-surface);
            color: var(--color-text-dark);
        }

        .nav-active {
            color: var(--color-accent-amber);
            border-bottom: 2px solid var(--color-accent-amber);
        }

        .nav-link {
            color: var(--color-text-dark);
            border-bottom: 2px solid transparent;
        }

        .nav-link:hover {
            color: var(--color-accent-amber);
            border-bottom-color: var(--color-border-soft);
        }

        /* Mobile Nav Icons */
        .nav-icon {
            color: var(--color-text-muted);
        }

        .nav-icon:hover {
            color: var(--color-accent-amber);
        }

        .nav-icon-active {
            color: var(--color-accent-amber);
        }

        /* Dropdown Menu */
        .dropdown-menu {
            background-color: var(--color-surface);
        }

        .dropdown-item:hover {
            background-color: var(--color-border-soft);
        }

        /* Form Styles */
        .form-input {
            background-color: var(--color-input-bg);
            border: 1px solid var(--color-input-border);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            width: 100%;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
            color: var(--color-text-dark);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-input-focus);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }

        .form-input::placeholder {
            color: var(--color-text-muted);
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--color-text-dark);
        }

        .form-hint {
            font-size: 0.875rem;
            color: var(--color-text-muted);
            margin-top: 0.25rem;
        }

        textarea.form-input {
            min-height: 200px;
            resize: vertical;
        }

        /* Problem report link card */
        .linked-problem-card {
            background-color: var(--color-problem-light-bg);
            border: 1px solid var(--color-problem-light-border);
            border-radius: 8px;
            padding: 0.75rem;
        }

        .problem-color-text {
            color: var(--color-problem-base);
        }

        .log-color-text {
            color: var(--color-log-base);
        }

        /* File upload */
        .file-upload-area {
            border: 2px dashed var(--color-border-soft);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.15s ease, background-color 0.15s ease;
        }

        .file-upload-area:hover {
            border-color: var(--color-log-base);
            background-color: var(--color-log-light-bg);
        }

        /* Pill Styles */
        .pill-style {
            border-radius: 9999px;
            padding: 0.4rem 1rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            line-height: 1;
        }

        .status-pill-fixing {
            background-color: #FEF3C7;
            color: #B45309;
            border: 1px solid #FCD34D;
        }

        /* Sidebar section */
        .sidebar-section {
            border-bottom: 1px solid var(--color-border-soft);
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }

        .sidebar-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .sidebar-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-muted);
            margin-bottom: 0.5rem;
        }

        /* Theme switcher - only for static HTML prototype, don't put into live app */
        .theme-switcher {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            background: var(--color-surface);
            border: 1px solid var(--color-border-soft);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            border-radius: 9999px;
            padding: 0.35rem 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 40;
            font-size: 0.9rem;
        }

        .theme-switcher button {
            border: none;
            background: transparent;
            padding: 0.2rem 0.6rem;
            border-radius: 9999px;
            cursor: pointer;
            color: var(--color-text-dark);
            font-weight: 600;
            transition: background 0.15s ease, color 0.15s ease;
        }

        .theme-switcher button:hover {
            background: var(--color-border-soft);
        }

        .theme-switcher button.is-active {
            background: var(--color-accent-amber);
            color: #fff;
        }

        /* Dark theme text overrides */
        body[data-theme="dark3"] h1,
        body[data-theme="dark3"] h2,
        body[data-theme="dark3"] h3,
        body[data-theme="dark3"] .text-gray-800,
        body[data-theme="dark3"] .text-gray-700,
        body[data-theme="dark3"] .text-gray-600 {
            color: #e5e7eb !important;
        }

        body[data-theme="dark3"] .text-gray-500,
        body[data-theme="dark3"] .text-gray-400 {
            color: #9ca3af !important;
        }

        /* Dark mode: fix secondary buttons and pills */
        body[data-theme="dark3"] .bg-gray-100 {
            background-color: var(--color-secondary-bg) !important;
        }

        body[data-theme="dark3"] .text-gray-700 {
            color: var(--color-secondary-text) !important;
        }

        body[data-theme="dark3"] .border-gray-300 {
            border-color: var(--color-secondary-border) !important;
        }

        /* Main content needs padding for the fixed header */
        #main-content {
            padding-top: 5rem;
        }
    </style>
  </head>
  <body>
    <!-- === PERSISTENT SITE HEADER === -->
    <header class="app-header fixed top-0 w-full border-b border-gray-200 z-30 p-3 shadow-sm flex justify-between items-center h-16">
      <a href="#" class="flex items-center gap-2 shrink-0">
        <img src="../../../the_flip/static/core/images/logo_blue.svg"
             alt="The Flip"
             class="brand-logo">
      </a>
      <!-- Desktop nav (md+) -->
      <nav class="hidden md:flex gap-4 text-base font-medium items-center">
        <a href="#" class="px-3 py-1 font-bold nav-active">Machines</a>
        <a href="#" class="px-3 py-1 nav-link">Problem Reports</a>
        <a href="#" class="px-3 py-1 nav-link">Logs</a>
        <!-- Admin Dropdown (superadmin only) -->
        <div class="relative">
          <button id="admin-dropdown-toggle-desktop"
                  class="px-3 py-1 nav-link flex items-center gap-1"
                  onclick="toggleAdminMenu('desktop')">
            Admin <i class="fa-solid fa-caret-down text-xs"></i>
          </button>
          <div id="admin-menu-desktop"
               class="hidden absolute left-0 top-8 w-56 card-style p-3 shadow-xl text-base z-50 dropdown-menu">
            <a href="#" class="block p-2 dropdown-item rounded-lg"><i class="fa-solid fa-users-gear mr-2"></i> Shared Accounts</a>
            <a href="#" class="block p-2 dropdown-item rounded-lg"><i class="fa-solid fa-envelope mr-2"></i> Invite User</a>
            <a href="#" class="block p-2 dropdown-item rounded-lg"><i class="fa-solid fa-toolbox mr-2"></i> Django Admin</a>
          </div>
        </div>
      </nav>
      <!-- Mobile nav (icon-only) -->
      <nav class="flex md:hidden gap-3 text-xl items-center">
        <a href="#" class="p-2 nav-icon-active"><i class="fa-solid fa-list"></i></a>
        <a href="#" class="p-2 nav-icon"><i class="fa-solid fa-triangle-exclamation"></i></a>
        <a href="#" class="p-2 nav-icon"><i class="fa-solid fa-screwdriver-wrench"></i></a>
        <!-- Admin Dropdown (superadmin only) -->
        <div class="relative">
          <button id="admin-dropdown-toggle-mobile"
                  class="p-2 nav-icon"
                  onclick="toggleAdminMenu('mobile')">
            <i class="fa-solid fa-users"></i>
          </button>
          <div id="admin-menu-mobile"
               class="hidden absolute right-0 top-10 w-56 card-style p-3 shadow-xl text-base z-50 dropdown-menu">
            <a href="#" class="block p-2 dropdown-item rounded-lg"><i class="fa-solid fa-users-gear mr-2"></i> Shared Accounts</a>
            <a href="#" class="block p-2 dropdown-item rounded-lg"><i class="fa-solid fa-envelope mr-2"></i> Invite User</a>
            <a href="#" class="block p-2 dropdown-item rounded-lg"><i class="fa-solid fa-toolbox mr-2"></i> Django Admin</a>
          </div>
        </div>
      </nav>
      <div class="flex items-center gap-2 md:gap-4 relative">
        <div id="account-dropdown-toggle"
             class="flex w-9 h-9 bg-amber-600 text-white rounded-full items-center justify-center font-bold text-sm cursor-pointer"
             onclick="toggleAccountMenu()">PW</div>
        <div id="account-menu"
             class="hidden absolute right-0 top-10 w-48 card-style p-3 shadow-xl text-base z-50 dropdown-menu">
          <p class="text-sm text-gray-500 mb-2">PinballWizard99</p>
          <a href="#" class="block p-2 dropdown-item rounded-lg"><i class="fa-solid fa-gear mr-2"></i> Account</a>
          <a href="#" class="block p-2 dropdown-item rounded-lg text-red-600"><i class="fa-solid fa-right-from-bracket mr-2"></i> Logout</a>
        </div>
      </div>
    </header>
    <!-- === MAIN CONTENT === -->
    <main id="main-content" class="p-4 lg:p-8 max-w-6xl mx-auto relative">
      <!-- BREADCRUMBS -->
      <div class="text-gray-500 mb-4 flex items-center gap-2 text-sm lg:text-base">
        <a href="#" class="text-gray-500 hover:text-amber-600 transition">Machines</a>
        <span>/</span>
        <a href="#" class="text-gray-500 hover:text-amber-600 transition">The Addams Family</a>
        <span>/</span>
        <a href="#" class="text-gray-500 hover:text-amber-600 transition">Problem #47</a>
        <span>/</span>
        <span class="font-semibold text-gray-700">Log Work</span>
      </div>
      <!-- TWO COLUMN LAYOUT: Main Form + Sidebar (no page title) -->
      <form class="flex flex-col lg:flex-row gap-5">
        <!-- MAIN COLUMN: Primary form fields -->
        <div class="flex-1 space-y-3">
          <!-- WORK DESCRIPTION (no card wrapper) -->
          <div>
            <label for="description" class="form-label text-sm">
              What work was done? <span class="text-red-500">*</span>
            </label>
            <textarea id="description"
                      name="description"
                      class="form-input text-sm py-2"
                      placeholder="Describe the work performed..."
                      required>Replaced the coil on the upper right flipper. It was showing resistance issues. Test played one game, feels snappy now.</textarea>
            <!-- File upload link (GitHub-style) -->
            <div class="mt-2 text-sm">
              <input type="file"
                     id="file-input"
                     class="hidden"
                     multiple
                     accept="image/*,video/*">
              <a href="#"
                 id="file-upload-link"
                 class="text-gray-500 hover:text-blue-600 hover:underline">
                <i class="fa-solid fa-paperclip mr-1"></i>Paste, drop, or click to add files
              </a>
            </div>
            <!-- Uploaded files preview (example) -->
            <div class="mt-2 flex gap-2 flex-wrap">
              <div class="relative group">
                <div class="w-14 h-14 bg-gray-200 rounded flex items-center justify-center">
                  <i class="fa-solid fa-image text-gray-400"></i>
                </div>
                <button type="button"
                        class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                  <i class="fa-solid fa-xmark text-xs"></i>
                </button>
              </div>
            </div>
          </div>
          <!-- WHEN/WHO (visible on mobile, hidden on desktop - shown in sidebar instead) -->
          <div class="lg:hidden grid grid-cols-2 gap-3 pt-3 border-t border-gray-200">
            <div>
              <label class="sidebar-label">When</label>
              <input type="datetime-local"
                     id="work_date_mobile"
                     name="work_date"
                     class="form-input text-sm py-2">
            </div>
            <div>
              <label class="sidebar-label">Who</label>
              <input type="text"
                     id="maintainers_mobile"
                     name="maintainers"
                     class="form-input text-sm py-2"
                     placeholder="Who did the work?">
            </div>
          </div>
          <!-- FORM ACTIONS (compact, right-aligned) -->
          <div class="flex flex-wrap items-center justify-end gap-3 pt-3 border-t border-gray-200">
            <!-- Close problem checkbox -->
            <label class="flex items-center gap-2 cursor-pointer text-sm">
              <input type="checkbox"
                     id="close_problem"
                     name="close_problem"
                     class="w-4 h-4 text-green-600 rounded border-gray-300">
              <span class="text-gray-700">Close the problem report</span>
            </label>
            <!-- Buttons (always inline) -->
            <a href="#"
               class="button-style bg-gray-100 text-gray-700 px-4 py-1.5 text-sm font-medium flex items-center justify-center gap-1 border border-gray-300 hover:bg-gray-200">
              Cancel
            </a>
            <button type="submit"
                    class="button-style log-button text-white px-4 py-1.5 text-sm font-semibold flex items-center justify-center gap-1">
              <i class="fa-solid fa-check text-xs"></i>
              Log It
            </button>
          </div>
        </div>
        <!-- SIDEBAR: Context & Metadata (desktop only) -->
        <div class="hidden lg:block lg:w-72 shrink-0">
          <div class="card-style p-4 lg:sticky lg:top-20">
            <!-- MACHINE -->
            <div class="sidebar-section">
              <div class="sidebar-label">Machine</div>
              <div class="font-semibold text-gray-800 text-lg">The Addams Family</div>
              <div class="text-sm text-gray-500">Bally • 1992</div>
              <div class="flex flex-wrap gap-2 mt-2">
                <span class="pill-style status-pill-fixing text-xs py-1 px-2">
                  <i class="fa-solid fa-wrench text-xs"></i>
                  Fixing
                </span>
                <span class="pill-style bg-gray-100 text-gray-700 border border-gray-300 text-xs py-1 px-2">
                  <i class="fa-solid fa-location-dot text-xs"></i>
                  Workshop
                </span>
              </div>
            </div>
            <!-- LINKED PROBLEM -->
            <div class="sidebar-section">
              <div class="sidebar-label">Problem</div>
              <a href="#" class="linked-problem-card block">
                <div class="flex items-baseline gap-1 text-sm">
                  <i class="fa-solid fa-bug problem-color-text"></i>
                  <span class="font-semibold problem-color-text">#47</span>
                </div>
                <p class="text-gray-700 text-sm mt-0.5 line-clamp-2">
                  Top right flipper barely moves when I hit the button. Ball gets stuck.
                </p>
                <p class="text-gray-500 text-xs mt-1">Visitor • Yesterday</p>
              </a>
            </div>
            <!-- WHEN -->
            <div class="sidebar-section">
              <div class="sidebar-label">When</div>
              <input type="datetime-local"
                     id="work_date"
                     name="work_date"
                     class="form-input text-sm py-2">
            </div>
            <!-- WHO -->
            <div class="sidebar-section">
              <div class="sidebar-label">Who</div>
              <div class="flex flex-wrap gap-1 mb-2">
                <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">
                  TechSam
                  <button type="button" class="hover:text-blue-600">
                    <i class="fa-solid fa-xmark text-xs"></i>
                  </button>
                </span>
              </div>
              <input type="text"
                     id="maintainers"
                     name="maintainers"
                     class="form-input text-sm py-2"
                     placeholder="Who did the work?">
            </div>
          </div>
        </div>
      </form>
    </main>
    <!-- Theme Switcher (for demo only) -->
    <div class="theme-switcher">
      <button data-theme="default" class="is-active">Light</button>
      <button data-theme="dark3">Dark</button>
    </div>
    <script>
      // Desktop Account Dropdown
      function toggleAccountMenu() {
        const menu = document.getElementById('account-menu');
        menu.classList.toggle('hidden');
        // Close admin menus when opening account menu
        document.getElementById('admin-menu-desktop').classList.add('hidden');
        document.getElementById('admin-menu-mobile').classList.add('hidden');
      }

      // Admin Dropdown
      function toggleAdminMenu(variant) {
        const menu = document.getElementById('admin-menu-' + variant);
        menu.classList.toggle('hidden');
        // Close the other admin menu and account menu
        const otherVariant = variant === 'desktop' ? 'mobile' : 'desktop';
        document.getElementById('admin-menu-' + otherVariant).classList.add('hidden');
        document.getElementById('account-menu').classList.add('hidden');
      }

      // Close menus on outside click
      document.addEventListener('click', function(event) {
        const accountMenu = document.getElementById('account-menu');
        const accountToggle = document.getElementById('account-dropdown-toggle');
        const adminMenuDesktop = document.getElementById('admin-menu-desktop');
        const adminToggleDesktop = document.getElementById('admin-dropdown-toggle-desktop');
        const adminMenuMobile = document.getElementById('admin-menu-mobile');
        const adminToggleMobile = document.getElementById('admin-dropdown-toggle-mobile');

        // Close account menu if clicking outside
        if (accountMenu && accountToggle && !accountMenu.contains(event.target) && !accountToggle.contains(event.target)) {
          accountMenu.classList.add('hidden');
        }

        // Close admin desktop menu if clicking outside
        if (adminMenuDesktop && adminToggleDesktop && !adminMenuDesktop.contains(event.target) && !adminToggleDesktop.contains(event.target)) {
          adminMenuDesktop.classList.add('hidden');
        }

        // Close admin mobile menu if clicking outside
        if (adminMenuMobile && adminToggleMobile && !adminMenuMobile.contains(event.target) && !adminToggleMobile.contains(event.target)) {
          adminMenuMobile.classList.add('hidden');
        }
      });

      // File upload click handler
      document.getElementById('file-upload-link').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('file-input').click();
      });

      // Theme switching
      (function() {
        const buttons = document.querySelectorAll('.theme-switcher button');

        function setTheme(theme) {
          document.body.setAttribute('data-theme', theme);
          buttons.forEach(btn => {
            btn.classList.toggle('is-active', btn.dataset.theme === theme);
          });
        }

        buttons.forEach(btn => {
          btn.addEventListener('click', () => setTheme(btn.dataset.theme));
        });

        setTheme('default');
      })();

      // Set current datetime in the work_date field
      (function() {
        const dateInput = document.getElementById('work_date');
        if (dateInput) {
          const now = new Date();
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const day = String(now.getDate()).padStart(2, '0');
          const hours = String(now.getHours()).padStart(2, '0');
          const minutes = String(now.getMinutes()).padStart(2, '0');
          dateInput.value = `${year}-${month}-${day}T${hours}:${minutes}`;
        }
      })();
    </script>
  </body>
</html>
