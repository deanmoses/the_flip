{% extends 'tickets/base.html' %}
{% load reporter_tags %}

{% block title %}Tasks - {{ machine.name }}{% endblock %}

{% block content %}
<div class="report-detail">
    <div class="report-header">
        <h1>Open Tasks for <a href="{% url 'machine_detail' machine.slug %}">{{ machine.name }}</a></h1>
        <h2>
            Current machine status: <span class="badge badge-{{ machine.operational_status }}">{{ machine.get_operational_status_display }}</span>
        </h2>
    </div>

    <div class="updates-section">
        <h3>Tasks</h3>

        {% if tasks %}
            <div class="timeline">
                {% for task in tasks %}
                <div class="timeline-item">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <div class="update-text">
                            <p>
                                {% if task.type == 'problem_report' %}
                                    <span class="badge badge-{{ task.type }}">
                                        {{ task.get_type_display }}
                                    </span>
                                    {% if task.problem_type != 'other' %}
                                        <strong>{{ task.get_problem_type_display }}:</strong>
                                    {% endif %}
                                {% endif %}
                                <a href="{% url 'task_detail' task.pk %}">{{ task.problem_text }}</a>
                            </p>
                        </div>
                        <div class="update-meta">
                            <span class="update-author">{{ task|creator_display }}</span>
                            <span class="update-time">{{ task.created_at|smart_date }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="no-updates">No open tasks or problem reports.</p>
        {% endif %}
    </div>

    <div class="maintainer-actions">
        <h3>Add Task</h3>

        <form method="post" class="update-form">
            {% csrf_token %}

            <div class="form-group">
                {{ quick_form.problem_text }}
                {% if quick_form.problem_text.errors %}
                    <div class="form-errors">{{ quick_form.problem_text.errors }}</div>
                {% endif %}
            </div>

            <div class="action-buttons">
                <button type="submit" class="btn btn-primary">
                    Create Task
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
